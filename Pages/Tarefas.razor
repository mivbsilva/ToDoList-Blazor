@page "/tarefas"
@using System.Collections.Generic

<h1 class="text-2xl font-bold mb-4">Painel de Tarefas</h1>

<input @bind="novaTarefa" placeholder="Digite uma nova tarefa"
       class="border p-2 rounded w-full mb-2" />

<button @onclick="AdicionarTarefa" class="bg-blue-500 text-white px-4 py-2 rounded">Adicionar</button>

<ul class="mt-4">
    @foreach (var tarefa in tarefas.Select((t, i) => new { Texto = t, Index = i }))
    {
        <li class="border-b py-2 flex justify-between items-center">
            @if (tarefa.Index == tarefaEditandoIndex)
            {
                <!-- Input para editar -->
                <input @bind="tarefaEditadaTexto" class="border p-2 rounded w-full mr-2" />

                <button @onclick="SalvarEdicao" class="bg-green-500 text-white px-2 py-1 rounded ml-2">Salvar</button>
                <button @onclick="CancelarEdicao" class="bg-gray-400 text-white px-2 py-1 rounded ml-2">Cancelar</button>
            }
            else
            {
                <span>@tarefa.Texto</span>

                <button @onclick="() => EditarTarefa(tarefa.Index)" class="text-blue-500 text-sm ml-2">
                    ✏️ Editar
                </button>
            }
        </li>
    }
</ul>

@code {
    private string novaTarefa;
    private List<string> tarefas = new();

    private int? tarefaEditandoIndex = null; // qual tarefa estou editando (null = nenhuma)
    private string tarefaEditadaTexto = string.Empty; // o texto novo enquanto edita

    private void AdicionarTarefa()
    {
        if (!string.IsNullOrWhiteSpace(novaTarefa))
        {
            tarefas.Add(novaTarefa);
            novaTarefa = string.Empty;
        }
    }

    private void EditarTarefa(int index)
    {
        tarefaEditandoIndex = index;
        tarefaEditadaTexto = tarefas[index]; // coloca no input o valor atual
    }

    private void SalvarEdicao()
    {
        if (tarefaEditandoIndex != null && !string.IsNullOrWhiteSpace(tarefaEditadaTexto))
        {
            tarefas[(int)tarefaEditandoIndex] = tarefaEditadaTexto;
            tarefaEditandoIndex = null;
            tarefaEditadaTexto = string.Empty;
        }
    }

    private void CancelarEdicao()
    {
        tarefaEditandoIndex = null;
        tarefaEditadaTexto = string.Empty;
    }
}
